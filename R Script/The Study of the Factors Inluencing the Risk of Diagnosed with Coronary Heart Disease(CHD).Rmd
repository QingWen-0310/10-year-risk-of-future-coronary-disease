---
title: "The Study of the Factors Inluencing the Risk of Diagnosed with Coronary Heart Disease(CHD)"
author: "Qing Wen"
date: "2020/12/21"
output: pdf_document
bibliography: reference.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
```

# Note(Github Repo)

# Abstract


## Key Words
Coronary Heart Disease, Risk Factor, Framingham Heart Study, Longitudinal Study

# Introduction
There has been a rising awareness globally towards improving human health and promoting the importance of tracking one's own health status. As an increasing amount of innovative technology comes out around the world, enhancement in medical equipment and new breakthroughs within the medical field has provided a strengthened understanding of diseases that were once thought untreatable. Doctors and scientists are also utilizing their expertise to convince people what should be done in their normal life as early prevention for any preventable diseases. 

Among all the diseases that could cause the early death of an individual, cardiovascular disease(CVD) accounts for the number one reason for such deaths. According to the World Health Organization, an estimated 17.9 million people died from CVDs in 2016, which accounted for approximately 31% of the global deaths[@citeWHO]. Looking more closely, CVD is a group of disorders of the heart and blood vessels, including disorders like cerebrovascular disease, coronary heart disease(CHD), and congenital heart disease. However, even with the high death rate, CVD is considered to be preventable if individuals could address their behavioral risk factors.

With no special preference, CHD is picked as the objective of our study and we want to find potential factors that help determine the risk of individuals being diagnosed with CHD. According to the Mayo Clinic, CHD is a disorder caused by damage to the major blood vessel. Cholesterol-containing deposits accumulate within the arteries and gradually narrow the blood vessels, making it hard to deliver blood and essential nutrients to the heart[@citeMayo]. As the risk of blocking the blood vessels likely to develop over decades, it becomes difficult for one to diagnose the problem early, probably not until one got a complete block of the arteries which causes a heart attack.

Therefore, in this study, potential risk factors contributing to the development of CHD is analyzed, and a logistic model is fitted to predict the probability of one being diagnosed with CHD in the future. In the end, we want to develop the importance of paying attention to certain health indications to help people adapt to a healthier lifestyle in the effort of decreasing the risk of having a CHD. 

The study will be conducted using the data obtained from a well-known longitudinal study regarding heart disease, namely the Framingham Heart Study which was first launched in 1948. In the Methodology section, more detailed information on the data would be provided and the underlying theory for the logistic model will be presented. Results regarding the analysis of the variables and the model output will be included in the Result section. Finally, further inferences regarding the results and any weaknesses associated with the study will be included in the Discussion section. 


# Methodology
## Data
### Framingham Heart Study(FHS)
The Framingham Heart Study(FHS) is an ongoing longitudinal study on heart disease. With a history of 72 years, FHS has successfully altered public approaches to treat CVDs. Back in 1948, little was known about heart disease despite its cause for the increasing death rate. What FHS has accomplished is revolutionary, as it contributes to uncovering general patterns and trends which is meaningful and applicable to the general population[@citeNHLBI].

As the study began in 1948, the first generation of the participants consisted of 5,209 men and women aged between 30-62 years from the town of Framingham, Massachusetts, who have not yet develop any noticeable symptoms of heart disease and have not had a stroke or heart attack beforehands[@citeFHS]. The participants were recruited and had their physical status extensively examined and recorded, and were expected to return for another round of detailed examination and lab tests every 5 to 6 years since then. In 1971, the next generation of these participants was enrolled in the study, and in 2002, the grandchildren of the original participants were examined for the new phase of the study. 

### Data for Study
The dataset used in this study is obtained from Kaggle for which the author requested from the original study. However, little details have been provided regarding which round of the study these observations are taken from, so we could not generalize the results to the specific study population. But the aim of this study is to determine the potential risk factors that could serve for the prediction of the risk of having a CHD. With the 4238 observations and 16 variables within the dataset after cleaning, we can use the prescribed model to yield predictions and provide analysis regarding some important variables in determining risks. 

The original dataset is almost clean and does not require too much manipulation. We removed the **education** and the **glucose** variable in the original dataset as they contain many missing values. Also, the rest of the observations that contain missing values are removed. In the end, 4088 observations are present in the data for our latter analysis, which is considerable sample size for our goal of study.

Table 1: An Overview of the Data on Heart Disease Used in the Study

```{r, echo=FALSE, message=FALSE, warning=FALSE}
heart_data <- read_csv("C:/Users/10128/Desktop/STA304/Final project/cleaned_data.csv")

# kable(head(heart_data), format = "latex", digits = 0, booktabs = T) %>% 
#   column_spec(column = 1:14, width = "0.5in")

heart_data_1 <- heart_data[1:7]
heart_data_2 <- heart_data[8:14]
knitr::kable(head(heart_data_1))
knitr::kable(head(heart_data_2))
```

Table 2: Definitions of Variables in the Data Set

```{r, echo=FALSE, message=FALSE, warning=FALSE}
variable_name = variable.names(heart_data)
meaning <- c("whether the patient is male", "the age of the patient", "whether the patient is currently smoking", "cigarettes per day if the patient is smoking", "whether the patient is on blood pressure medication", "whether the patient had a stroke before", "whether the patient is hypertensive", "whether the patient has diabetes", "total cholesterol level", "systolic blood pressure", "diastolic blood pressure", "Body Mass Index", "the patient's heart rate", "whether the patient has a 10-year-risk of CHD")

knitr::kable(data.frame(variable_name, meaning))
```

Table 1 shows an overview of the data structure, and Table 2 gives a precise definition for each of the variables present in the data set. The variable TenYearCHD indicates whether the patient has a 10-year-risk of developing a CHD, so we will use this as the binary response in the logistic model. Among all the potential predictors, variables **male**, **age**, **currentSmoker**, **BPMeds**, **totChol**, **BMI** are selected as predictors in this study. As we have previously noted, the CHD develops as the main blood vessels are blocked by cholesterol-containing deposits, which is a huge indication of having a healthy lifestyle and physical status like total cholesterol value and the Body Mass Index(BMI). Studies have shown that smoking changes the blood chemistry, which contaminates the oxygen-rich blood to flow into the heart. Also, sex and age are often common factors that are involved in disease development. Hence, these variables are selected for further study.


## Model
To accomplish the objective of predicting the risk of patients having CHD, there is a clear indication of the adoption of a logistic model, since we are trying to predict whether a patient has the risk of being diagnosed with CHD which is a binary response variable. Specifically, the theoretical model with our pre-selected predictors and response will be defined as follows: $$log(\frac{p}{1-p}) = \beta_0 + \beta_1x_{male} + \beta_2x_{age} + \beta_3x_{currentSmoker}+\beta_4x_{BloodPressureMedication} + \beta_5x_{totalCholesterol} + \beta_6x_{BMI}$$

The variable on the left-side of the equation represents the log odds, which is a log transformation on the probability we target in finding. Any changes resulted from the significant predictor variables will result in the average change in the log odds. However, in order to form more understandable and more meaningful conclusions from the model output, we should apply the exponential transformation to the log odds in order to obtain our final probability. To give a simple but concrete example to demonstrate this mechanism, suppose we have a simplified version of our defined logistic model that only consists of one predictor: age, and the estimate for $\beta_0 = -10.8$, and the estimate for $\beta_1 = 0.23$. Suppose we have a patient that is 52 years-old, and we want to predict the probability of this patient having CHD. Using the estimated model, we would have $log(\frac{\hat{p}}{1-\hat{p}}) = -10.8 + 0.23*52$ = `r -10.8+0.23*52`. In order to find the probability, we apply an exponential transformation as follows: $e^{log(\frac{\hat{p}}{1-\hat{p}})} = \frac{\hat{p}}{1-\hat{p}} = e^{1.16}$. By isolating for $\hat{p}$, we can find the probability of the patient having CHD is 0.76.

With this calculation in mind, we will define other parameters in the model in its naive meanings(i.e. their meaning as regard to the log odds):

$p$: the predicted probability of the patient being diagnosed with CHD

$\beta_1$: the average difference in log odds resulted from the patient being a male or a female

$\beta_2$: the expected change in log odds resulted from a one unit increase in age

$\beta_3$: the average difference in log odds resulted from whether the patient is a smoker

$\beta_4$: the average difference in log odds resulted from whether the patient is on blood pressure medication

$\beta_5$: the expected change in log odds resulted from a one unit increase in the total cholesterol level

$\beta_6$: the expected change in the log odds resulted from a one unit increase in the BMI

As seen from above, variables like *age*, *total cholesterol level* and *BMI* are all numerical variables, while the rest of the variables are categorical. Usually, categorical variables are treated as dummy variables in the model, which have different levels. For example, the *currentSmoker* variable would have two levels: whether the patient smokes or does not smoke. If the patient is a smoker, then the variable $x_{currentSmoker}$ would have a value of 1, and 0 otherwise. The categorical variables in our analysis all consist of two levels, and are coded as 1 if in the presence of the condition defined by the variable name, and 0 otherwise. 


# Result

According to the model output, the fitted model is written as follows: $$log(\frac{\hat{p}}{1-\hat{p}}) = -7.7645 + 0.5656x_{male} + 0.0777x_{age} + 0.4154x_{currentSmoker}+0.6946x_{BloodPressureMedication}$$ $$+ 0.0025x_{totalCholesterol} + 0.0351x_{BMI}$$

Table 3: Statistics for the Coefficient Estimates from the Logistic Model

```{r, echo=FALSE, message=FALSE, warning=FALSE}
attach(heart_data)
# build the logistic model
logit <- glm(TenYearCHD~as.factor(male) + age + as.factor(currentSmoker) + as.factor(BPMeds) + totChol + BMI, family = "binomial")

# build a summary table from the summary output of the model
Coefficient <- c("intercept", "male", "age", "current smoker", "blood pressure medication", "total cholesterol level", "BMI")

Estimate <- c(round(summary(logit)$coefficient[1, 1], 4), round(summary(logit)$coefficient[2, 1], 4), round(summary(logit)$coefficient[3, 1], 4), round(summary(logit)$coefficient[4, 1], 4), round(summary(logit)$coefficient[5, 1], 4), round(summary(logit)$coefficient[6, 1], 4), round(summary(logit)$coefficient[7, 1], 4))

Standard_Error <- c(round(summary(logit)$coefficient[1, 2], 4), round(summary(logit)$coefficient[2, 2], 4), round(summary(logit)$coefficient[3, 2], 4), round(summary(logit)$coefficient[4, 2], 4), round(summary(logit)$coefficient[5, 2], 4), round(summary(logit)$coefficient[6, 2], 4), round(summary(logit)$coefficient[7, 2], 4))

p_value <- c("< 0.001", "< 0.001", "< 0.001", "< 0.001", round(summary(logit)$coefficient[5, 4], 4), round(summary(logit)$coefficient[6, 4], 4), round(summary(logit)$coefficient[7, 4], 4))

summary_table <- data_frame(Coefficient, Estimate, Standard_Error, p_value)
summary_table <- summary_table %>% 
  rename("Standard Error" = Standard_Error) %>% 
  rename("p value" = p_value)

knitr::kable(summary_table)

detach(heart_data)
```

From table 3, we see that all the coefficient estimates for the slope parameters are positive. Taking the predictor variable current Smoker as an example, table 3 shows the estimate for it is 0.4154. It means that holding other variables constant, if the patient is a current smoker, then the odds would increase by $e^{-7.7645+0.4154} = e^{-7.349}$. To get the probability of a patient who smokes being diagnosed with CHD, we get that $\hat{p} = \frac{e^{-7.349}}{1+e^{-7.349}}$ = `r (exp(-7.349))/(1+exp(-7.349))`. On the other hand, holding other variables constant, if the patient is not a current smoker, then the odds would increase by $e^{-7.7654}$. Following by a similar argument, the probability of the patient who does not smoke being diagnosed with CHD would be `r  (exp(-7.7654))/(1+exp(-7.7654))`. 

Also, we see that all the coefficient estimates have p-value much less than 0.05, suggesting that these predictors are all statistically significant. Among all the predictors, the table shows that the coefficient estimates for *male*, *current smoker*, and *blood pressure medication* are relatively bigger than the rest of the estimates, not accounting for the intercept estimate. 


Table 4: Proportion of Patients with Different Sex Having CHD
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tsex <- heart_data %>%
  mutate(male = ifelse(male == 1, "male", "female")) %>%
  group_by(male) %>%
  summarise(proportion = mean(TenYearCHD))

# tsmoker <- heart_data %>%
#   mutate(currentSmoker = ifelse(currentSmoker == 1, "smoker", "non-smoker")) %>%
#   group_by(currentSmoker) %>%
#   summarise(proportion = mean(TenYearCHD))
# 
# tsmoker

tmed <- heart_data %>%
  mutate(BPMeds = ifelse(BPMeds == 1, "on medication", "not on medication")) %>%
  group_by(BPMeds) %>%
  summarise(proportion = mean(TenYearCHD))

knitr::kable(tsex)
```

Table 5: Proportion of Patients Taking Blood Pressure Medication Having CHD 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(tmed)
```

Table 4 and 5 each gives a simple proportion summary for patients with certain characteristics having CHD. From Table 4, around 18.9% of the males in the data have CHD while around 11.9% of females in the data have CHD. From Table 5, around 32.5% of the patients who take blood pressure medications have CHD, and around 14.4% of the patients who do not take blood pressure medications have CHD.


Table 6: Proportion of CHD Patients Smoking Different Number of Cigarettes Per Day

```{r, echo=FALSE, message=FALSE, warning=FALSE}

heart_data <- heart_data %>%
  mutate(cigarettesGroup = case_when(
    cigsPerDay == 0 ~ "do not smoke",
    cigsPerDay > 0 & cigsPerDay < 15 ~ "under 15",
    cigsPerDay >= 15 & cigsPerDay < 30 ~ "more than 15 but less than 30",
    cigsPerDay >= 30 & cigsPerDay < 45 ~ "more than 30 but less than 45",
    cigsPerDay >= 45 & cigsPerDay < 60 ~ "more than 45 but less than 60",
    cigsPerDay >= 60 ~ "more than 60"
  ))

tsmoker1 <- heart_data %>% 
  group_by(cigarettesGroup) %>%
  mutate(total = n()) %>% 
  summarise(proportion = sum(TenYearCHD)/611)

knitr::kable(tsmoker1)
```

Table 6 shows that among the patients who are diagnosed with CHD, what proportion of them smokes the number of cigarettes as categorized by each cigarette group presented in the table. The table shows that patients who do not smoke constitute around 48% of patients who are diagnosed with CHD. Among the rest of the patients who do smoke, people who smoke 15 to 30 cigarettes per day constitutes the largest part of the patients who have CHD. On the other hand, only a small proportion of people diagnosed with CHD smokes around 45-60+ cigarettes per day is the lowest.

# Discussion

## Summary

In this study, we investigate the potential factors that influence the probability of one being diagnosed with CHD, a heart disease. We started by looking at the data set and variable definitions, then justifies the subset of variables we choose to include in this study. We then moved on to describe the logistic model and its interpretations. After that, results regarding the model output in included in the result section, and all the p-value for the coefficient estimates are statistically significant in a 0.05 significance level. Further interpretations of the results and remarks will be discussed next.

## Conlcusion

From the previous result section, we found that all the predictor variables seem to be significant, as the p-values for their coefficient estimates are all smaller than 0.05. Hence, we would not further consider variable selection techniques to try to reduce our existing model. However, looking closely to the estimates, variable *total cholesterol level* has a small estimate for its coefficient, namely 0.0025. When transformed back to the probability, we found that with 1 unit increase in total cholesterol level, the expected change in log odds is0.0025, holding other variables constant. Exponentiating it, we get that $e^{0.0025}$ = `r exp(0.0025)`. This means that we expect to see a 0.25% increase in the odds of being diagnosed with CHD, which is not too big a change. 

On the other hand, looking at the variable *blood pressure medication*, it seems to be the predictor variable that has the greatest impact on the response variable, as it has the largest coefficient estimates among all the other selected predictors. Specifically, the odds for patients who take blood pressure medication `r (exp(0.6946)/(1+exp(0.6946)) - 1)*100`% higher than the odds for patients who do not take blood pressure medication. 

Following the same constructs, The other coefficient estimates can be interpreted accordingly. Despite the magnitude of the impact each predictor has on the response variable, we also want to comment on the fact that all the coefficient estimates are positive. To elaborate on this, patients who is male, is currently smoking, and is on blood pressure medication all increase the probability of them being diagnosed with CHD. Furthermore, with older age, larger BMI, and higher total cholesterol level, the probability for a patient being diagnosed with CHD also increases. Table 4 and 5 in the results section also confirms the fact that with the data collected, males and patients who are on blood pressure medication seems to more likely to be diagnosed with CHD.

From Table 6 of the results, we see that patients who smoke constitutes a slightly larger proportion of the patients who are diagnosed with CHD. We anticipate that people who smoke would have a higher chance of developing CHD. Looking back to the data set, there are a lot less observations collected from people who smoke more than 30 cigarettes per day than from those who smoke less than 30 cigarettes per day. 

Hence, it ties back to the fact that the development of the CHD hugely rely on the living habits the patients have. CHD can be preventable as patients take control of these controllable risk factors. 

### TODO: further elaborate on each predictor's impact on the risk




## Weaknesses

Though we obtained a model with all significant covariates and yield meaningful results, there is also weaknesses that we fail to cover in the study. 

To start with, the data we used in the study does not indicate which round of the FHS study it was collected from, so we lack the ability to generate a specific set of conclusions and descriptions of the pattern pertaining to the population of which the data is collected from. What we did accomplish is to try to generalize the result to the general public and develop some tips for early-prevention of the disease. Nonetheless, if more information could be extracted from the data source, and perhaps including data from other rounds of the data could yield more solid and reliable conclusions and potentially investigate the family pattern of the disease development. 

Furthermore, as described previously, FHS is a longitudinal study and is thereby costly and time-consuming to conduct. So far, only 3 to 4 rounds of study has been carefully carried out. Though many studies and researches have been successful in extracting information from the data and provide the public with a much enhanced understanding on the CHD, the data collection process is still taking place and conclusions drawn previously in the study could be elevated or altered depending on the richer data available.

Lastly, the set of predictor variable we choose to estimate their underlying risks for affecting the probability of being diagnosed with CHD is: **male**, **age**, **current smoker**, **blood pressure medication**, **total cholesterol level**, and **BMI**. Though we proved that these factors all contribute to the risk of having CHD, there is no way to validate that these are and are only the factors that potentially affect the outcome. The variables chosen are with sound justifications but potentially more underlying factors that do not seem to have an apparent relationship with the CHD could also affect the outcome significantly. 


## Next Steps

To address some of the weaknesses mentioned previously, the FHS keeps a full record of all the observations from each round of the study. Their current goal is not only keep tracking of the families' medical histories from the first generation of the study, they now aim at more detailed objective of the studies since basic patterns of the CHD has been revealed in the past century. FHS now design and modify their studies to encounter the effect like the race and ethnicity have on the study outcome, which could improve the richness or the data and allow more analysis targeting at narrower topics to be conducted. 

Also, it may be valuable to investigate more of the variables present in the current data set to find any other significant determinants for the outcome. Our goal would still be to obtain a parsimonious model. Assessing different subsets of predictors by building multiple models and comment on the conclusions could enrich the arguments we made in this study. 

## Concluding Remarks
To conclude, we want first assert that the conclusions drawn from this study is based on an observational study and no causal relationship is inferred from the context. However, with observational data we still yield meaningful results to determine the potential risk factors for a patient being diagnosed with CHD. 

### TODO: elaborate more on concluding remarks



\newpage
# References





